<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
      (function () {
        try {
          var t =
            localStorage.getItem("berry.v1.theme") ||
            localStorage.getItem("berry.theme") ||
            "dark";
          t = String(t).toLowerCase().startsWith("light") ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", t);
        } catch (e) {}
      })();
    </script>
    <link rel="stylesheet" href="theme.css" />
    <script src="app.js" defer></script>
    <title>Berry Tally</title>
  </head>
  <body>
    <div class="wrap">
      <header class="header-flex">
        <div class="theme-switch" style="margin-right: 8px">
          <input
            type="checkbox"
            id="themeToggle"
            aria-label="Toggle light mode"
          />
          <label for="themeToggle">
            <span class="moon">üåô</span>
            <span class="sun">‚òÄÔ∏è</span>
          </label>
        </div>
        <div style="text-align: center">
          <h1>
            Granja Suiza Berry app
            <svg
              aria-label="Switzerland flag"
              role="img"
              width="20"
              height="20"
              viewBox="0 0 28 28"
              style="
                vertical-align: -3px;
                margin-left: 6px;
                border-radius: 3px;
                display: inline-block;
              "
            >
              <rect width="28" height="28" fill="#D52B1E" />
              <rect x="12" y="5" width="4" height="18" fill="#ffffff" />
              <rect x="5" y="12" width="18" height="4" fill="#ffffff" />
            </svg>
          </h1>
          <div style="font-size: 0.9rem; color: var(--muted); margin-top: 2px">
            Niels/Thomas Beerli Cockpit
          </div>
        </div>
        <div class="pill-row">
          <span
            class="pill pill--fresh"
            id="pillFresh"
            data-i18n-aria="pill.fresh"
            >Fresh stock: 0 kg</span
          >
          <span
            class="pill pill--frozen"
            id="pillFrozen"
            data-i18n-aria="pill.frozen"
            >Frozen stock: 0 kg</span
          >
        </div>
      </header>
      <div class="row">
        <section class="card" id="card-harvest" aria-labelledby="h2-harvest">
          <div class="card-head">
            <h2 id="h2-harvest" data-i18n="harvest.title">Harvest</h2>
            <div
              class="lang-switch pillgroup"
              role="radiogroup"
              aria-label="Language"
            >
              <input type="radio" id="langEn" name="lang" value="en" checked />
              <label for="langEn">EN</label>
              <input type="radio" id="langDe" name="lang" value="de" />
              <label for="langDe">DE</label>
              <input type="radio" id="langGsw" name="lang" value="gsw" />
              <label for="langGsw">GSW</label>
            </div>
          </div>
          <div class="grid" style="margin-bottom: 8px">
            <div class="g-4">
              <label for="harvestDate" data-i18n="harvest.date">Date</label>
              <input id="harvestDate" type="date" />
            </div>
            <div class="g-4">
              <label for="harvestBerry" data-i18n="harvest.berry">Berry</label>
              <select id="harvestBerry"></select>
            </div>
            <div class="g-3">
              <label data-i18n="harvest.product">Product</label>
              <div
                class="pillgroup"
                role="radiogroup"
                aria-label="Harvest product"
              >
                <input
                  type="radio"
                  id="hvProdFrozen"
                  name="hvProduct"
                  value="frozen"
                  checked
                />
                <label for="hvProdFrozen" data-i18n="common.frozen"
                  >Frozen</label
                >
                <input
                  type="radio"
                  id="hvProdFresh"
                  name="hvProduct"
                  value="fresh"
                />
                <label for="hvProdFresh" data-i18n="common.fresh">Fresh</label>
              </div>
            </div>
            <div class="g-1">
              <label for="harvestWeight" data-i18n="harvest.weight_kg"
                >Weight (kg)</label
              >
              <div class="input-with-suffix">
                <input
                  id="harvestWeight"
                  type="number"
                  inputmode="decimal"
                  min="0.1"
                  step="0.1"
                  placeholder="e.g., 1.8"
                />
                <span class="input-suffix">kg</span>
              </div>
            </div>
            <div class="g-3">
              <label for="harvestPickerPYG" data-i18n="harvest.picker_pyg"
                >Picker salary (PYG)</label
              >
              <input
                id="harvestPickerPYG"
                type="text"
                inputmode="text"
                placeholder="e.g. 50k"
              />
            </div>
          </div>

          <div class="row" style="margin-bottom: 8px">
            <button
              id="btnAddHarvest"
              type="button"
              class="btn primary"
              data-i18n="harvest.add"
            >
              Add
            </button>
          </div>

          <div class="table-scroll-x table-scroll-10">
            <table
              class="table-compact"
              id="harvestTable"
              aria-label="Harvest entries"
              style="min-width: 640px"
            >
              <thead>
                <tr>
                  <th data-i18n="table.date">Date</th>
                  <th data-i18n="table.berry">Berry</th>
                  <th class="right" data-i18n="table.frozen_kg">Frozen (kg)</th>
                  <th class="right" data-i18n="table.fresh_kg">Fresh (kg)</th>
                  <th class="right" data-i18n="harvest.picker_pyg">
                    Picker salary (PYG)
                  </th>
                  <th class="right" data-i18n="table.actions">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="row" style="margin-top: 8px">
            <button
              id="btnExportHarvestCSV"
              type="button"
              class="btn"
              data-i18n="harvest.export"
            >
              Export CSV (Harvests)
            </button>
          </div>
        </section>

        <section class="card" id="card-mixer" aria-labelledby="h2-mixer">
          <h2 id="h2-mixer" data-i18n="mixer.title">Mixer</h2>

          <div class="subcard" id="mixerBox">
            <h3 style="margin: 6px 0" data-i18n="mixer.create">
              Create packages
            </h3>
            <div class="grid" style="margin-bottom: 8px">
              <div class="g-3">
                <label data-i18n="mixer.product">Product</label>
                <div
                  class="pillgroup"
                  role="radiogroup"
                  aria-label="Package product"
                >
                  <input
                    type="radio"
                    id="mxProdFrozen"
                    name="mxProduct"
                    value="frozen"
                    checked
                  />
                  <label for="mxProdFrozen" data-i18n="common.frozen"
                    >Frozen</label
                  >
                  <input
                    type="radio"
                    id="mxProdFresh"
                    name="mxProduct"
                    value="fresh"
                  />
                  <label for="mxProdFresh" data-i18n="common.fresh"
                    >Fresh</label
                  >
                </div>
              </div>
              <div class="g-3">
                <label for="mxSize" data-i18n="mixer.size_g"
                  >Package size (g)</label
                >
                <select id="mxSize">
                  <option value="250">250</option>
                  <option value="500">500</option>
                  <option value="1000">1000</option>
                  <option value="custom" data-i18n="mixer.size_custom_option">
                    Custom‚Ä¶
                  </option>
                </select>
              </div>
              <div class="g-3" id="mxSizeCustomWrap" hidden>
                <label for="mxSizeCustom" data-i18n="mixer.size_custom_g"
                  >Custom size (g)</label
                >
                <input
                  id="mxSizeCustom"
                  type="number"
                  min="1"
                  step="1"
                  placeholder="e.g., 750"
                  disabled
                />
              </div>
              <div class="g-3">
                <label for="mxCount" data-i18n="mixer.count">Count</label>
                <input id="mxCount" type="number" min="1" step="1" value="1" />
              </div>
            </div>

            <div class="grid" id="mxMixGrid" style="margin-bottom: 8px">
              <!-- per-berry grams inputs will be built from BERRIES -->
              <!-- Each row: <div class="g-3"><label>Berry name</label><input data-mx-berry="id" type="number" min="0" step="1"></div> -->
            </div>

            <div class="row" style="margin-bottom: 8px">
              <div class="kpi" style="padding: 8px">
                <div class="kpi-label" data-i18n="mixer.kpi_sum_remain">
                  Sum / Remaining (g)
                </div>
                <div class="kpi-value">
                  <span id="mxSum">0</span> / <span id="mxRemain">0</span>
                </div>
              </div>
              <div class="kpi" style="padding: 8px">
                <div class="kpi-label" data-i18n="mixer.kpi_cost_per_bag">
                  Cost / bag (PYG)
                </div>
                <div class="kpi-value" id="mxCost">0</div>
              </div>
            </div>

            <div class="row">
              <button
                id="btnCreatePackages"
                type="button"
                class="btn primary"
                disabled
              >
                <span data-i18n="mixer.create_btn">Create packages</span>
              </button>
            </div>
          </div>
        </section>

        <section class="card" id="card-storage" aria-labelledby="h2-storage">
          <div class="card-head">
            <h2 id="h2-storage" data-i18n="storage.title">Storage</h2>
          </div>
          <div class="table-scroll-10">
            <table
              class="table-compact"
              id="storageTable"
              aria-label="Storage by berry"
            >
              <thead>
                <tr>
                  <th data-i18n="storage.berry">Berry</th>
                  <th class="right" data-i18n="storage.frozen_kg">
                    Frozen (kg)
                  </th>
                  <th class="right" data-i18n="storage.fresh_kg">Fresh (kg)</th>
                  <th class="right" data-i18n="storage.value_pyg">
                    Value (PYG)
                  </th>
                  <th class="right" data-i18n="storage.days">
                    Days since last
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr class="total-row">
                  <th data-i18n="totals.total">Total</th>
                  <th class="right" id="totFrozenKg">0.00</th>
                  <th class="right" id="totFreshKg">0.00</th>
                  <th class="right" id="totValuePYG">0</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>

          <h3 style="margin: 6px 0" data-i18n="storage.packaged_inventory">
            Packaged inventory
          </h3>
          <div class="table-scroll-10">
            <table
              class="table-compact"
              id="packagedTable"
              aria-label="Packaged inventory"
            >
              <thead>
                <tr>
                  <th data-i18n="table.date">Date</th>
                  <th data-i18n="storage.product">Product</th>
                  <th data-i18n="storage.size_g">Size</th>
                  <th data-i18n="storage.mix">Mix</th>
                  <th class="right" data-i18n="storage.count">Count</th>
                  <th class="right" data-i18n="storage.cost_per_bag_pyg">
                    Cost/bag (PYG)
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Bulk actions: remove/sell -->
          <div class="subcard" id="bulkActionsBox">
            <h3 style="margin: 6px 0" data-i18n="storage.bulk_title">
              Bulk actions
            </h3>
            <div class="grid" style="margin-bottom: 8px">
              <div class="g-3">
                <label data-i18n="storage.type">Type</label>
                <div
                  class="pillgroup"
                  role="radiogroup"
                  aria-label="Action type"
                >
                  <input
                    type="radio"
                    id="stTypeBulk"
                    name="stType"
                    value="bulk"
                    checked
                  />
                  <label for="stTypeBulk" data-i18n="storage.bulk">Bulk</label>
                  <input
                    type="radio"
                    id="stTypePack"
                    name="stType"
                    value="packaged"
                  />
                  <label for="stTypePack" data-i18n="storage.packaged"
                    >Packaged</label
                  >
                </div>
              </div>
              <div class="g-3" id="bulkRowBerry">
                <label for="actBerry" data-i18n="storage.berry">Berry</label>
                <select id="actBerry"></select>
              </div>
              <div class="g-3" id="bulkRowProduct">
                <label data-i18n="storage.product">Product</label>
                <div
                  class="pillgroup"
                  role="radiogroup"
                  aria-label="Bulk product"
                >
                  <input
                    type="radio"
                    id="stProdFrozen"
                    name="stProduct"
                    value="frozen"
                    checked
                  />
                  <label for="stProdFrozen" data-i18n="common.frozen"
                    >Frozen</label
                  >
                  <input
                    type="radio"
                    id="stProdFresh"
                    name="stProduct"
                    value="fresh"
                  />
                  <label for="stProdFresh" data-i18n="common.fresh"
                    >Fresh</label
                  >
                </div>
              </div>
              <div class="g-3" id="bulkRowAmount">
                <label for="actWeight" data-i18n="storage.amount_g"
                  >Amount (g)</label
                >
                <input
                  id="actWeight"
                  type="number"
                  min="1"
                  step="1"
                  placeholder="e.g. 500"
                />
              </div>

              <!-- Packaged fields (shown when Type=Packaged) -->
              <div class="g-6" id="packRowSelect" hidden>
                <label for="packSel" data-i18n="storage.package">Package</label>
                <select id="packSel"></select>
              </div>
              <div class="g-2" id="packRowCount" hidden>
                <label for="packCount" data-i18n="storage.count">Count</label>
                <input
                  id="packCount"
                  type="number"
                  min="1"
                  step="1"
                  value="1"
                />
              </div>
              <div class="g-3">
                <label data-i18n="storage.action">Action</label>
                <div
                  class="pillgroup"
                  role="radiogroup"
                  aria-label="Bulk action"
                >
                  <input
                    type="radio"
                    id="stActRemove"
                    name="stAction"
                    value="remove"
                    checked
                  />
                  <label for="stActRemove" data-i18n="common.remove"
                    >Remove</label
                  >
                  <input
                    type="radio"
                    id="stActSold"
                    name="stAction"
                    value="sold"
                  />
                  <label for="stActSold" data-i18n="common.sold">Sold</label>
                </div>
              </div>
              <div class="g-6">
                <label for="actNote" data-i18n="sales.note">Note</label>
                <input
                  id="actNote"
                  type="text"
                  placeholder="e.g., Caf√© Rosa, cash"
                  data-i18n-placeholder="sales.note_ph"
                />
              </div>
            </div>
            <div class="row" style="margin-bottom: 8px">
              <button
                id="btnDoBulkAction"
                type="button"
                class="btn primary"
                data-i18n="storage.apply"
              >
                Apply
              </button>
            </div>
          </div>
        </section>
        <section class="card" id="card-sales" aria-labelledby="h2-sales">
          <div class="card-head">
            <h2 id="h2-sales" data-i18n="sales.title">Sales</h2>
          </div>

          <!-- Filters -->
          <div class="grid" style="margin-bottom: 8px">
            <div class="g-3">
              <label for="salesMonth" data-i18n="sales.month">Month</label>
              <select id="salesMonth">
                <option value="all" data-i18n="sales.month_all">
                  All months
                </option>
              </select>
            </div>
            <div class="g-3">
              <label for="salesBerry" data-i18n="table.berry">Berry</label>
              <select id="salesBerry">
                <option value="all" data-i18n="sales.berry_all">
                  All berries
                </option>
              </select>
            </div>
          </div>

          <!-- Table -->
          <div class="table-scroll-10">
            <table class="table-compact" id="salesTable" aria-label="Sales">
              <thead>
                <tr>
                  <th data-i18n="table.date">Date</th>
                  <th data-i18n="table.berry">Berry</th>
                  <th data-i18n="sales.prod">Prod</th>
                  <th class="right" data-i18n="sales.amount_kg">Amount (kg)</th>
                  <th class="right" data-i18n="sales.price_pygkg">
                    Price (PYG/kg)
                  </th>
                  <th class="right" data-i18n="sales.value_pyg">Value (PYG)</th>
                  <th data-i18n="sales.note">Note</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr class="total-row">
                  <th data-i18n="totals.total">Total</th>
                  <th></th>
                  <th></th>
                  <th class="right" id="salesTotKg">0.00</th>
                  <th></th>
                  <th class="right" id="salesTotVal">0</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>

          <!-- Summaries -->
          <div class="grid" style="margin-top: 8px">
            <div class="g-6">
              <h3 style="margin: 6px 0" data-i18n="sales.sum_by_month">
                Summary by Month
              </h3>
              <table class="table-compact" id="salesSumMonth">
                <thead>
                  <tr>
                    <th data-i18n="sales.month">Month</th>
                    <th class="right" data-i18n="table.kg">Kg</th>
                    <th class="right" data-i18n="sales.value_pyg">
                      Value (PYG)
                    </th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="g-6">
              <h3 style="margin: 6px 0" data-i18n="sales.sum_by_berry">
                Summary by Berry
              </h3>
              <table class="table-compact" id="salesSumBerry">
                <thead>
                  <tr>
                    <th data-i18n="table.berry">Berry</th>
                    <th class="right" data-i18n="table.kg">Kg</th>
                    <th class="right" data-i18n="sales.value_pyg">
                      Value (PYG)
                    </th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div class="row" style="margin-top: 8px">
            <button
              id="btnExportSalesCSV"
              type="button"
              class="btn"
              data-i18n="sales.export"
            >
              Export CSV (Sales)
            </button>
          </div>
        </section>

        <section
          class="card"
          id="card-analytics"
          aria-labelledby="h2-analytics"
        >
          <div class="card-head">
            <h2 id="h2-analytics" data-i18n="analytics.title">
              Harvest Analytics
            </h2>
          </div>

          <!-- Filters -->
          <div class="grid" style="margin-bottom: 8px">
            <div class="g-3">
              <label for="anaBerry" data-i18n="analytics.berry">Berry</label>
              <select id="anaBerry">
                <option value="all" data-i18n="analytics.all_berries">
                  All berries
                </option>
              </select>
            </div>
            <div class="g-3">
              <label for="anaPeriod" data-i18n="analytics.period">Period</label>
              <select id="anaPeriod">
                <option value="last7" data-i18n="analytics.last7">
                  Last 7 days
                </option>
                <option value="last30" data-i18n="analytics.last30">
                  Last 30 days
                </option>
                <option
                  value="thisYear"
                  data-i18n="analytics.thisYear"
                  selected
                >
                  This year
                </option>
              </select>
            </div>
            <div class="g-3">
              <label for="anaAgg" data-i18n="analytics.agg">Aggregation</label>
              <select id="anaAgg">
                <option value="week" data-i18n="analytics.week">Week</option>
                <option value="month" data-i18n="analytics.month" selected>
                  Month
                </option>
                <option value="year" data-i18n="analytics.year">Year</option>
              </select>
            </div>
          </div>

          <!-- KPIs -->
          <div class="grid kpi-row" style="margin-bottom: 8px">
            <div class="g-3 kpi">
              <div class="kpi-label" data-i18n="table.total_kg">Total (kg)</div>
              <div class="kpi-value" id="kpiTotalKg">0.00</div>
            </div>
            <div class="g-3 kpi">
              <div class="kpi-label" data-i18n="analytics.count">
                # Harvests
              </div>
              <div class="kpi-value" id="kpiCount">0</div>
            </div>
            <div class="g-3 kpi">
              <div class="kpi-label" data-i18n="analytics.avg_per_harvest">
                Avg kg/harvest
              </div>
              <div class="kpi-value" id="kpiAvgKg">0.00</div>
            </div>
            <div class="g-3 kpi">
              <div class="kpi-label" data-i18n="analytics.first_last">
                First / Last
              </div>
              <div class="kpi-value" id="kpiFirstLast">‚Äî</div>
            </div>
            <div class="g-3 kpi">
              <div class="kpi-label" data-i18n="analytics.picker_cost">
                Picker salary (PYG)
              </div>
              <div class="kpi-value" id="kpiPickerPYG">0</div>
            </div>
          </div>

          <!-- Charts -->
          <div class="grid">
            <div class="g-6">
              <h3
                id="h3AggTotals"
                style="margin: 6px 0"
                data-i18n="analytics.weekly_totals"
              >
                Weekly totals (kg)
              </h3>
              <canvas
                id="chartWeekly"
                width="600"
                height="280"
                role="img"
                aria-label="Weekly totals"
              ></canvas>
            </div>
            <div class="g-6">
              <h3 style="margin: 6px 0" data-i18n="analytics.ma7">
                7-day moving average (kg)
              </h3>
              <canvas
                id="chartMA"
                width="600"
                height="280"
                role="img"
                aria-label="7-day moving average"
              ></canvas>
            </div>
          </div>
        </section>

        <section class="card" id="card-prices" aria-labelledby="h2-prices">
          <div class="card-head">
            <h2 id="h2-prices" data-i18n="prices.title">Prices</h2>
          </div>
          <p class="muted" data-i18n="prices.hint">
            Set current PYG/kg for bulk products. You can type ‚Äúk‚Äù shorthand
            (e.g., 80k). Values round to nearest 5,000.
          </p>
          <div class="table-scroll-10">
            <table
              class="table-compact"
              id="pricesTable"
              aria-label="Prices per berry"
            >
              <thead>
                <tr>
                  <th data-i18n="prices.berry">Berry</th>
                  <th class="right" data-i18n="prices.fresh_pyg">
                    Fresh PYG/kg
                  </th>
                  <th class="right" data-i18n="prices.frozen_pyg">
                    Frozen PYG/kg
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <section class="card" id="card-backup" aria-labelledby="h2-backup">
          <div class="card-head">
            <h2 id="h2-backup" data-i18n="backup.title">Backup & Restore</h2>
          </div>
          <p class="muted" data-i18n="backup.hint">
            Your data is saved in your browser (localStorage). Export a backup
            before switching devices or clearing browser data.
          </p>
          <div class="row" style="margin-top: 8px">
            <button
              id="btnExportBackup"
              type="button"
              class="btn"
              data-i18n="backup.export_btn"
            >
              Export backup (.json)
            </button>
            <div>
              <input
                id="fileImportBackup"
                type="file"
                accept="application/json"
              />
            </div>
            <button
              id="btnImportBackup"
              type="button"
              class="btn"
              data-i18n="backup.import_btn"
            >
              Import backup
            </button>
          </div>
        </section>
      </div>
    </div>
  </body>
</html>
